name: 'Version'

on:
    workflow_run:
        workflows: ['CI']
        types:
            - completed

jobs:
    versionize:
        runs-on: ubuntu-latest
        outputs:
            version: ${{ steps.get-version.outputs.version }}
        steps:
        - uses: actions/checkout@v3
          with: 
            fetch-depth: 0

        - name: Setup .NET
          uses: actions/setup-dotnet@v3
          with:
            dotnet-version: 7.0.x

        - name: add git credentials
          run: |
              git config --global user.name "github-actions[bot]"
              git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

        - name: dotnet tool restore
          run: dotnet tool restore

        - name: Versionize
          run: dotnet tool run versionize
      
        - name: get-version
          id: get-version
          run: echo "version=$(dotnet tool run versionize inspect)" >> $GITHUB_OUTPUT
      
        - name: git push changelog
          run: git push --follow-tags origin master
